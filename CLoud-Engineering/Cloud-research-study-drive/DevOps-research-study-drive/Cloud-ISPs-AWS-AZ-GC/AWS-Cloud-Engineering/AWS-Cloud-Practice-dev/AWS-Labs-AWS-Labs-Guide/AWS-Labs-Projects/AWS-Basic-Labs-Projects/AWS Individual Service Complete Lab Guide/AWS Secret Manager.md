# AWS Secret Manager Hands-On Lab (Beginner â†’ Advanced)

> **Author & Arthitecture Designer:** Charlie

## RDS MySQL + Secrets Manager h


#### âœ… METHOD 1 RDS Automatically Creates and Manages Secrets Manager Secret (BEST & RECOMMENDED):

##### ðŸ“Œ Overview: In this method, AWS automatically creates and manages a secret in AWS Secrets Manager during RDS MySQL database creation.

##### This happens when you select the option:

> **â€œManage master credentials in AWS Secrets Managerâ€**

##### Note: This is an AWS-recommended best practice and is widely used in production environments.

##### ðŸ§  What This Method Means

##### Instead of manually creating:

- âœ” Database username

- âœ” Database password

- âœ” Secret JSON structure

##### AWS automatically:

- âœ” Generates the secret

- âœ” Stores credentials securely

- âœ” Keeps it synchronized with RDS

- âœ” Enables optional automatic rotation

#### How It Works

1. **You create an RDS MySQL database**
2. **You enable Secrets Manager integration**
3. **AWS automatically:**
    - Stores master username & password
    - Stores DB endpoint and port
    - Encrypts the secret using KMS
4. **Applications (Lambda, EC2, ECS) read credentials from Secrets Manager**

##### ðŸ“Œ RDS does NOT read from Secrets Manager

###### Secrets Manager is for applications, not for RDS itself.

#### ðŸ” Auto-Created Secret Structure (Example)

##### AWS creates a secret with this structure:

```
{
  "username": "admin",
  "password": "AutoGeneratedPassword",
  "engine": "mysql",
  "host": "app-mysql-db.xxxxxx.region.rds.amazonaws.com",
  "port": 3306,
  "dbname": "appdb"
}
```

- âœ” Automatically populated
- âœ” No manual input required
- âœ” Ready for Lambda or EC2 usage

#### ðŸ“ Secret Location & Naming

##### The secret is created in AWS Secrets Manager with a name similar to:

```
rds-db-credentials/app-mysql-db
```

or

```
rds!db-ABCDEFG123
```

##### You can:

- Rename the secret

- Add tags

- Restrict IAM permissions

- Enable rotation

#### ðŸ” Password Rotation Support

##### This method fully supports automatic password rotation:

- Secrets Manager generates a new password

- Updates RDS master password

- Updates the secret value

- Old password is invalidated

  - âœ” Secure
  - âœ” No hardcoding
  - âœ” Production-safe

#### ðŸ Using the Auto-Created Secret in Lambda (Python)

```
response = secrets_client.get_secret_value(
    SecretId="rds-db-credentials/app-mysql-db"
)

secret = json.loads(response["SecretString"])
```

##### Access values:

```
secret["username"]
secret["password"]
secret["host"]
secret["port"]
secret["dbname"]
```

#### ðŸŽ¯ When to Use This Method

##### Use Method 3 when:

- One application uses one RDS database

- You want AWS-managed security

- You want automatic rotation

- You want minimal configuration errors

- You follow AWS best practices

#### âœ… Done.

---

#### âœ… METHOD 2 Create Secret Using RDS Integration  (Best & RECOMMENDED / MANUAL):

##### ðŸ“Œ When to Use

- âœ” Production
- âœ” Beginner friendly
- âœ” Auto-sync with RDS
- âœ” Supports rotation easily

1. Open **AWS Console â†’ Secrets Manager**
2. Click **Store a new secret**
3. Choose **Credentials for RDS database**

##### âœ” This tells AWS:

> **â€œThis secret is for a databaseâ€**

4. Enter Credentials

##### Fill in:

```
| Field           | Value              |
| --------------- | ------------------ |
| Username        | admin              |
| Password        | StrongPassword123! |
| Database engine | MySQL              |
```
###### âš ï¸ Must match RDS master username/password

5. Select RDS Database

##### âœ” AWS will automatically attach:

- DB endpoint

- Port

- Engine

6. Secret name:

###### Use a clean DevOps-style name:

   ```
   rds/mysql/app/credentials
   ```

7. (Optional) Rotation

For now:

```
Disable automatic rotation
```

8. **Store Secret :** Click Store

#### âœ… Done.

#### ðŸ”Ž What AWS Stores Internally (Auto JSON)

```json
{
  "username": "admin",
  "password": "StrongPassword123!",
  "engine": "mysql",
  "host": "app-mysql-db.xxxxxx.region.rds.amazonaws.com",
  "port": 3306,
  "dbname": "appdb"
}
```

###### ðŸ“Œ This is exactly what Lambda reads.

---

#### âœ… METHOD 3 (ADVANCED / MANUAL):
##### Create Secret Manually (DevOps-Style)
##### ðŸ“Œ When to Use

- âœ” Lambda labs
- âœ” Multi-DB environments
- âœ” Custom apps
- âœ” CI/CD pipelines

1. Open **AWS Console â†’ Secrets Manager**
2. **Choose Secret Type:**  Other type of secret
3. Add Key-Value Pairs

##### Paste: 

```
{
  "username": "admin",
  "password": "StrongPassword123!",
  "host": "app-mysql-db.xxxxxx.region.rds.amazonaws.com",
  "port": 3306,
  "dbname": "appdb"
}
```

4. Secret Name:

###### Use a clean DevOps-style name:

```
rds/mysql/app/credentials
```

5. **Store Secret :** Click Store

6. **ðŸ§ª VERIFY SECRET (IMPORTANT)**

#### Steps

- Open the secret

- Click Retrieve secret value

- Confirm all fields are correct

**âœ” This is what your Lambda code will read.**


#### ðŸ How Lambda Uses This Secret (Python Reminder)

```
response = secrets_client.get_secret_value(
    SecretId='rds/mysql/app/credentials'
)

secret = json.loads(response['SecretString'])
```
##### Then

```
secret['username']
secret['password']
secret['host']
secret['port']
secret['dbname']
```

##### ðŸš« COMMON MISTAKES (VERY IMPORTANT)

```
| Mistake              | Result              |
| -------------------- | ------------------- |
| Wrong password       | DB connection fails |
| Wrong endpoint       | Timeout             |
| Lambda no permission | AccessDenied        |
| Port missing         | Connection error    |
| DB name missing      | Query failure       |
```

##### ðŸ” IAM PERMISSION REQUIRED

##### Your Lambda must have:

```
{
  "Effect": "Allow",
  "Action": "secretsmanager:GetSecretValue",
  "Resource": "*"
}
```

###### Note: (Or restricted to that secret ARN)

#### âœ… Done.


#### âš–ï¸ Comparison with Other Methods

```
| Feature             | Method 1 (Auto-created) | Method 2 (RDS-integrated) | Method 3 (Manual) |
| ------------------- | ------------------------- | ----------------- | ----------------------- |
| AWS recommended     | âœ… Yes                     | âœ… Yes          | âš ï¸ Depends                   |
| Manual effort       | âŒ No                      | âŒ No               | âœ… Yes                    |
| Auto rotation       | âœ… Easy                    | âœ… Easy             | âŒ Hard                  |
| Sync with RDS       | âœ… Yes                     | âœ… Yes              | âŒ No                   |
| Best for production | âœ… Yes                     | âœ… Yes          | âš ï¸ Depends                   |
```

#### ðŸ§  Key Takeaway

> **Method 1 is the safest, cleanest, and most production-ready way to manage RDS credentials using AWS Secrets Manager.**